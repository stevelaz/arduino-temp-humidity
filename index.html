<html>
<head>
    <title>Humidity and Temperature</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src='http://code.jquery.com/jquery-1.10.1.min.js' type='text/javascript'></script>
    <script type="text/javascript" src="/canvasjs.min.js"></script>
    <script>
    $(function() {
        //initial value of dataPoints
        var dps = [
            {label: "humidity", y: 38},
            {label: "temperature", y: 27}
        ];
        var chart = new CanvasJS.Chart("chartContainer",{
            title: { text: "Humidity and Temperature" },
            axisY: { suffix: " C" },
            legend :{
                verticalAlign: 'bottom',
                horizontalAlign: "center"
            },
            data: [{
                type: "column",
                bevelEnabled: true,
                indexLabel: "{y} C",
                dataPoints: dps
            }]
        });

        var updateChart = function (hum, temp) {
            // color of dataPoint dependent upon y value.
            hum_boilerColor =
                hum > 39 ? "#FF2500":
                hum >= 38 ? "#FF6000":
                hum < 37 ? "#6B8E23 ":
                null;
            temp_boilerColor =
                temp > 29 ? "#FF2500":
                temp >= 28 ? "#FF6000":
                temp < 27 ? "#6B8E23 ":
                null;

            dps[0] = {label: "humidity", y: hum, color: hum_boilerColor};
            dps[1] = {label: "temperature", y: temp, color: temp_boilerColor};
            chart.render();
        };

        var socket = io('http://localhost:8080');
        var count = 0;
        socket.on('sensor_data', function (data) {
            data = JSON.parse(data);
            if (count >= 4) {
                updateChart(data.humidity, data.temperature);
                count = 0;
            }
            count++;
        });
    });
    </script>
</head>
<body>
  <div id="chartContainer" style="height: 500px; width: 100%;">
</body>
</html>
