<html>
<head>
    <title>Humidity and Temperature</title>
    <link rel="stylesheet" href="/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src='http://code.jquery.com/jquery-1.10.1.min.js' type='text/javascript'></script>
    <script type="text/javascript" src="/canvasjs.min.js"></script>
    <script>
    $(function() {
        //initial value of dataPoints
        var dps = [
            {label: "Humidity %", y: 38},
            {label: "Temperature C", y: 27}
        ];

        var chart = new CanvasJS.Chart("chartContainer",{
            title: { text: "Humidity and Temperature" },
            axisY: { suffix: " " },
            legend :{
                verticalAlign: 'bottom',
                horizontalAlign: "center"
            },
            data: [
            {
                type: "column",
                bevelEnabled: true,
                indexLabel: "{y}",
                indexLabelFontSize: 26,
                indexLabelFontColor: "#000000",
                dataPoints: dps
            }]
        });

        var updateChart = function (hum, temp) {
            // color of dataPoint dependent upon y value.
            humidity_color =
                hum > 48 ? "#FF2500":
                hum >= 44 ? "#FF6000":
                hum < 40 ? "#6B8E23 ":
                null;
            temp_color =
                temp > 29 ? "#FF2500":
                temp >= 28 ? "#FF6000":
                temp < 27 ? "#6B8E23 ":
                null;

            dps[0] = {label: "Humidity %", y: hum, color: humidity_color};
            dps[1] = {label: "Temperature C", y: temp, color: temp_color};
            chart.render();
        };

        var socket = io('http://localhost:9080');
        var prevous_data = { humidity: 0, temperature: 0 }
        socket.on('sensor_data', function (data) {
            data = JSON.parse(data);
            /* only update if the data changes */
            if (prevous_data.humidity != data.humidity || prevous_data.temperature != data.temperature) {
                console.log('updating chart');
                updateChart(data.humidity, data.temperature);
            }
            prevous_data = data;
        });
    });
    </script>
</head>
<body>
  <div id="chartContainer" style="height: 500px; width: 100%;">
</body>
</html>
